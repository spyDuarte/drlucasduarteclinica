import{d as M,n as F,r as m,j as e,C as T,v as P,q as k,w as z,p as q,x as R,g as _,X as $}from"./index-BT7t7-AV.js";import{P as S}from"./plus-BOtOl9uJ.js";import{C as O,a as L}from"./chevron-right-B2wK9h7n.js";import{P as U}from"./phone-DXNOkvpN.js";import{C as B}from"./circle-alert-DoYUT0vC.js";const C=z("08:00","18:00",30);function Q(){const{patients:n,addAppointment:b,updateAppointment:u,deleteAppointment:p,getAppointmentsByDate:g}=M(),{showToast:c}=F(),[o,s]=m.useState(new Date),[i,v]=m.useState(!1),[r,a]=m.useState(null),[x,h]=m.useState(null),j=o.toISOString().split("T")[0],d=g(j),f=l=>{const t=new Date(o);t.setDate(t.getDate()+l),s(t)},I=()=>{s(new Date)},A=l=>d.find(t=>t.horaInicio===l),y=(l,t)=>{a(l||null),h(t||null),v(!0)},N=()=>{v(!1),a(null),h(null)},D=(l,t)=>{u(l,{status:t})};return e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary-500 to-primary-600 rounded-2xl flex items-center justify-center shadow-lg shadow-primary-500/20",children:e.jsx(T,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-gray-900",children:"Agenda"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Gerencie as consultas do dia"})]})]}),e.jsxs("button",{onClick:()=>y(),className:"btn-primary flex items-center justify-center gap-2 w-full sm:w-auto",children:[e.jsx(S,{className:"w-5 h-5"}),e.jsx("span",{children:"Nova Consulta"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("button",{onClick:()=>f(-1),className:"p-2 md:p-3 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-xl transition-colors","aria-label":"Dia anterior",children:e.jsx(O,{className:"w-5 h-5"})}),e.jsxs("div",{className:"text-center flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs md:text-sm text-primary-600 font-medium",children:P(o)}),e.jsxs("p",{className:"text-sm md:text-xl font-semibold text-gray-900 truncate",children:[e.jsx("span",{className:"hidden sm:inline",children:k(o,"EEEE, dd 'de' MMMM 'de' yyyy")}),e.jsx("span",{className:"sm:hidden",children:k(o,"EEE, dd/MM/yyyy")})]})]}),e.jsx("button",{onClick:()=>f(1),className:"p-2 md:p-3 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-xl transition-colors","aria-label":"Próximo dia",children:e.jsx(L,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx("button",{onClick:I,className:"btn-secondary text-sm",children:"Ir para hoje"})})]}),e.jsxs("div",{className:"card p-0 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-gray-50 to-gray-50/50 border-b border-gray-200 px-4 py-3",children:e.jsxs("h2",{className:"font-medium text-gray-900 flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-primary-500 rounded-full"}),d.length," consulta",d.length!==1?"s":""," agendada",d.length!==1?"s":""]})}),e.jsx("div",{className:"divide-y divide-gray-100 max-h-[60vh] overflow-y-auto",children:C.map(l=>{const t=A(l),E=t?n.find(w=>w.id===t.patientId):null;return e.jsxs("div",{className:`flex items-stretch hover:bg-gray-50 transition-colors ${t?"bg-white":"bg-gray-50/50"}`,children:[e.jsx("div",{className:"w-14 md:w-20 p-2 md:p-4 border-r border-gray-100 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xs md:text-sm font-medium text-gray-500",children:l})}),e.jsx("div",{className:"flex-1 p-2 md:p-4 min-w-0",children:t?e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-4 flex-1 cursor-pointer min-w-0",onClick:()=>y(t),children:[e.jsx("div",{className:"w-8 h-8 md:w-10 md:h-10 bg-sky-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(q,{className:"w-4 h-4 md:w-5 md:h-5 text-sky-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm md:text-base truncate",children:E?.nome||"Paciente não encontrado"}),e.jsxs("div",{className:"flex items-center gap-1 md:gap-2 text-xs md:text-sm text-gray-500",children:[e.jsx("span",{className:"truncate",children:R(t.tipo)}),t.motivo&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden sm:inline",children:"•"}),e.jsx("span",{className:"hidden sm:inline truncate",children:t.motivo})]})]})]})]}),e.jsx("div",{className:"flex items-center gap-2 ml-10 sm:ml-0",children:e.jsxs("select",{value:t.status,onChange:w=>D(t.id,w.target.value),className:`status-badge ${_(t.status)} border-0 cursor-pointer text-xs md:text-sm`,children:[e.jsx("option",{value:"agendada",children:"Agendada"}),e.jsx("option",{value:"confirmada",children:"Confirmada"}),e.jsx("option",{value:"aguardando",children:"Aguardando"}),e.jsx("option",{value:"em_atendimento",children:"Em atendimento"}),e.jsx("option",{value:"finalizada",children:"Finalizada"}),e.jsx("option",{value:"cancelada",children:"Cancelada"}),e.jsx("option",{value:"faltou",children:"Não compareceu"})]})})]}):e.jsxs("button",{onClick:()=>y(void 0,l),className:"w-full h-full flex items-center justify-center text-gray-400 hover:text-sky-600 transition-colors py-1",children:[e.jsx(S,{className:"w-4 h-4 md:w-5 md:h-5"}),e.jsx("span",{className:"ml-1 md:ml-2 text-xs md:text-sm",children:"Agendar"})]})})]},l)})})]}),i&&e.jsx(G,{appointment:r,selectedDate:j,selectedTime:x,patients:n,onClose:N,onSave:l=>{try{r?(u(r.id,l),c("Consulta atualizada com sucesso!","success")):(b(l),c("Consulta agendada com sucesso!","success")),N()}catch(t){c(t instanceof Error?t.message:"Erro ao salvar consulta","error")}},onDelete:r?()=>{p(r.id),c("Consulta excluída com sucesso!","success"),N()}:void 0})]})}function G({appointment:n,selectedDate:b,selectedTime:u,patients:p,onClose:g,onSave:c,onDelete:o}){const[s,i]=m.useState({patientId:n?.patientId||"",data:n?.data||b,horaInicio:n?.horaInicio||u||"09:00",horaFim:n?.horaFim||"",tipo:n?.tipo||"primeira_consulta",status:n?.status||"agendada",motivo:n?.motivo||"",valor:n?.valor?.toString()||"",convenio:n?.convenio||!1,observacoes:n?.observacoes||""});m.useEffect(()=>{if(s.horaInicio&&!s.horaFim){const[a,x]=s.horaInicio.split(":").map(Number),h=a*60+x+30,j=Math.floor(h/60),d=h%60;i(f=>({...f,horaFim:`${j.toString().padStart(2,"0")}:${d.toString().padStart(2,"0")}`}))}},[s.horaInicio]);const v=a=>{a.preventDefault();const x={patientId:s.patientId,data:s.data,horaInicio:s.horaInicio,horaFim:s.horaFim,tipo:s.tipo,status:s.status,motivo:s.motivo||void 0,valor:s.valor?parseFloat(s.valor):void 0,convenio:s.convenio,observacoes:s.observacoes||void 0};c(x)},r=p.find(a=>a.id===s.patientId);return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:n?"Editar Consulta":"Nova Consulta"}),e.jsx("button",{onClick:g,className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg",children:e.jsx($,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:v,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Paciente *"}),e.jsxs("select",{value:s.patientId,onChange:a=>i({...s,patientId:a.target.value}),className:"input-field",required:!0,children:[e.jsx("option",{value:"",children:"Selecione um paciente"}),p.map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))]}),r&&e.jsxs("div",{className:"mt-2 p-2 bg-gray-50 rounded-lg flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(U,{className:"w-4 h-4"}),r.telefone,r.alergias&&r.alergias.length>0&&e.jsxs("span",{className:"ml-auto flex items-center gap-1 text-red-600",children:[e.jsx(B,{className:"w-4 h-4"}),"Alergias: ",r.alergias.join(", ")]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data *"}),e.jsx("input",{type:"date",value:s.data,onChange:a=>i({...s,data:a.target.value}),className:"input-field",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Início *"}),e.jsx("select",{value:s.horaInicio,onChange:a=>i({...s,horaInicio:a.target.value,horaFim:""}),className:"input-field",required:!0,children:C.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fim *"}),e.jsx("select",{value:s.horaFim,onChange:a=>i({...s,horaFim:a.target.value}),className:"input-field",required:!0,children:C.filter(a=>a>s.horaInicio).map(a=>e.jsx("option",{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de consulta *"}),e.jsxs("select",{value:s.tipo,onChange:a=>i({...s,tipo:a.target.value}),className:"input-field",children:[e.jsx("option",{value:"primeira_consulta",children:"Primeira consulta"}),e.jsx("option",{value:"retorno",children:"Retorno"}),e.jsx("option",{value:"urgencia",children:"Urgência"}),e.jsx("option",{value:"exame",children:"Exame"}),e.jsx("option",{value:"procedimento",children:"Procedimento"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:s.status,onChange:a=>i({...s,status:a.target.value}),className:"input-field",children:[e.jsx("option",{value:"agendada",children:"Agendada"}),e.jsx("option",{value:"confirmada",children:"Confirmada"}),e.jsx("option",{value:"aguardando",children:"Aguardando"}),e.jsx("option",{value:"em_atendimento",children:"Em atendimento"}),e.jsx("option",{value:"finalizada",children:"Finalizada"}),e.jsx("option",{value:"cancelada",children:"Cancelada"}),e.jsx("option",{value:"faltou",children:"Não compareceu"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Motivo da consulta"}),e.jsx("input",{type:"text",value:s.motivo,onChange:a=>i({...s,motivo:a.target.value}),className:"input-field",placeholder:"Ex: Check-up, Dor de cabeça..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Valor (R$)"}),e.jsx("input",{type:"number",value:s.valor,onChange:a=>i({...s,valor:a.target.value}),className:"input-field",placeholder:"0,00",step:"0.01"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.convenio,onChange:a=>i({...s,convenio:a.target.checked}),className:"w-5 h-5 rounded border-gray-300 text-sky-600 focus:ring-sky-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Consulta por convênio"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observações"}),e.jsx("textarea",{value:s.observacoes,onChange:a=>i({...s,observacoes:a.target.value}),className:"input-field",rows:2})]}),e.jsxs("div",{className:"flex gap-3 justify-between pt-4 border-t border-gray-200",children:[e.jsx("div",{children:o&&e.jsx("button",{type:"button",onClick:o,className:"btn-danger",children:"Excluir"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:g,className:"btn-secondary",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn-primary",children:n?"Salvar":"Agendar"})]})]})]})]})})}export{Q as default};
